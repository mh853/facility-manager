# 매출 모달 레이아웃 재구성

## 📅 작업 일자
2025-11-10

## 🎯 작업 목표
사업장 매출 상세 모달의 정보 표시 순서를 사용자 경험에 최적화하여 재구성

## 📊 변경 전 레이아웃 순서

```
1. 사업장 기본 정보 (영업점, 진행구분, 제조사, 주소)
2. 매출/매입/이익 통계 카드 (4개 카드)
   - 매출금액
   - 매입금액
   - 순이익
   - 이익률
3. 설치 기기 목록 (테이블)
4. 추가 비용 정보 (추가공사비, 협의사항)
5. 비용 상세 내역 (영업비용, 실사비용, 설치비)
6. 계산서 및 입금 현황
```

## ✅ 변경 후 레이아웃 순서

```
1. 사업장 기본 정보 (영업점, 진행구분, 제조사, 주소)
2. 설치 기기 목록 (테이블) ⬆️ 위로 이동
3. 추가 비용 정보 (추가공사비, 협의사항) ⬆️ 위로 이동
4. 매출/매입/이익 통계 카드 (4개 카드) ⬇️ 아래로 이동
   - 매출금액
   - 매입금액
   - 순이익
   - 이익률
5. 비용 상세 내역 (영업비용, 실사비용, 설치비)
6. 계산서 및 입금 현황
```

## 🎨 변경 사유 및 UX 개선

### 1. 정보 계층 구조 개선
**Before**: 통계 카드 → 기기 목록
- 사용자가 먼저 요약 수치를 보고 → 상세 내역을 확인하는 구조
- 그러나 통계 수치의 **근거**가 되는 기기 목록이 뒤에 위치

**After**: 기기 목록 → 통계 카드
- 사용자가 먼저 **구체적인 기기 정보**를 확인 → 이를 바탕으로 계산된 통계를 이해
- **상세 → 요약** 순서로 자연스러운 정보 흐름

### 2. 논리적 정보 흐름
```
구체적 데이터 (What)          →    계산 결과 (How Much)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. 설치 기기 목록               →    4. 매출금액 = Σ(기기 매출)
   - pH 센서 2대                     매입금액 = Σ(기기 매입)
   - 차압계 3대                      순이익 = 매출 - 매입 - 비용
   - 게이트웨이 1대

2. 추가 비용 정보
   - 추가공사비 +500,000원
   - 협의사항 -200,000원

3. (중간 계산 과정)            →    5. 비용 상세 내역
                                      - 영업비용
                                      - 실사비용
                                      - 설치비
```

### 3. 사용자 인지 부하 감소
- **Before**: 통계를 보고 → "이 수치가 어떻게 나왔지?" → 스크롤 다운 → 기기 목록 확인
- **After**: 기기 목록 확인 → "이 기기들로 얼마가 나올까?" → 스크롤 다운 → 통계 확인

### 4. 데이터 검증 용이성
- 관리자가 매출 데이터를 검증할 때:
  1. 먼저 설치 기기가 정확한지 확인 (기기 목록)
  2. 추가 비용이 올바른지 확인 (추가 비용 정보)
  3. 최종 계산 결과 검토 (통계 카드)

## 🔧 구현 상세

### 변경된 파일
- `components/business/BusinessRevenueModal.tsx`

### 주요 변경 사항

#### 1. 설치 기기 목록 이동
**변경 전 위치**: line 446-517 (매출 통계 카드 이후)
**변경 후 위치**: line 340-411 (사업장 기본 정보 직후)

```typescript
{/* 설치 기기 목록 */}
<div>
  <h4 className="text-lg font-semibold text-gray-900 mb-4">설치 기기 목록</h4>
  <div className="overflow-x-auto">
    <table className="w-full border-collapse border border-gray-300">
      {/* 기기별 매출/매입 상세 테이블 */}
    </table>
  </div>
  <p className="text-xs text-gray-500 mt-2">
    * 매출단가는 환경부 고시가, 매입단가는 제조사별 원가가 적용됩니다.
  </p>
</div>
```

#### 2. 추가 비용 정보 이동
**변경 전 위치**: line 519-540 (설치 기기 목록 이후)
**변경 후 위치**: line 413-434 (설치 기기 목록 직후)

```typescript
{/* 추가 비용 정보 */}
<div>
  <h4 className="text-lg font-semibold text-gray-900 mb-4">추가 비용 정보</h4>
  <div className="bg-gray-50 rounded-lg p-4 space-y-3">
    <div className="flex items-center justify-between py-2 border-b border-gray-200">
      <span className="text-sm font-medium text-gray-700">추가공사비</span>
      <span className="text-base font-semibold text-green-700">
        {business.additional_cost ? `+${formatCurrency(business.additional_cost)}` : '₩0'}
      </span>
    </div>
    <div className="flex items-center justify-between py-2">
      <span className="text-sm font-medium text-gray-700">협의사항 (할인 금액)</span>
      <span className="text-base font-semibold text-red-700">
        {business.negotiation ? `-${formatCurrency(business.negotiation)}` : '₩0'}
      </span>
    </div>
  </div>
</div>
```

#### 3. 중복 섹션 제거
- 이전에 매출 통계 카드 이후에 있던 "설치 기기 목록"과 "추가 비용 정보" 섹션 제거
- 각 섹션이 한 번만 표시되도록 정리

## 📱 반응형 디자인 유지

모든 섹션의 반응형 레이아웃은 그대로 유지:
- **모바일**: 세로 스택 레이아웃
- **태블릿**: 2열 그리드 (일부 섹션)
- **데스크톱**: 4열 그리드 (통계 카드)

## 🎯 사용자 경험 개선 효과

### 1. 정보 발견성 향상
- 중요한 기기 정보가 상단에 위치하여 즉시 확인 가능
- 스크롤 없이 핵심 데이터를 먼저 파악

### 2. 데이터 신뢰성 강화
- 계산 근거(기기 목록)를 먼저 보여줌으로써 투명성 확보
- 통계 수치의 출처가 명확

### 3. 업무 효율성 증대
- 데이터 검증 워크플로우 최적화
- 관리자의 인지 부하 감소

### 4. 학습 곡선 단축
- 신규 사용자가 데이터 구조를 이해하기 쉬움
- 논리적인 정보 흐름으로 직관성 향상

## 🧪 테스트 가이드

### 시각적 검증
1. 매출 관리 페이지 접속
2. 임의의 사업장 선택 → 모달 열기
3. **순서 확인**:
   - ✅ 사업장 기본 정보 (최상단)
   - ✅ 설치 기기 목록 (테이블 형식)
   - ✅ 추가 비용 정보 (추가공사비, 협의사항)
   - ✅ 매출/매입/이익 통계 카드 (4개 컬러 카드)
   - ✅ 비용 상세 내역 (영업비용 조정 포함)
   - ✅ 계산서 및 입금 현황

### 기능 검증
1. 모든 섹션의 데이터가 정확히 표시되는지 확인
2. 통계 카드의 수치가 기기 목록 합계와 일치하는지 검증
3. 반응형 레이아웃 테스트 (모바일, 태블릿, 데스크톱)
4. 스크롤 동작 및 모달 닫기 기능 정상 작동 확인

### 사용자 피드백 수집
- 관리자 사용자 대상 만족도 조사
- 정보 찾기 시간 측정 (Before vs After)
- 데이터 검증 작업 시간 비교

## 📊 기대 효과

### 정량적 지표
- **정보 탐색 시간**: 20-30% 감소 예상
- **데이터 검증 시간**: 15-25% 감소 예상
- **사용자 오류율**: 10-15% 감소 예상

### 정성적 효과
- 사용자 만족도 향상
- 시스템 신뢰도 증가
- 업무 효율성 개선
- 신규 사용자 온보딩 시간 단축

## 🔜 향후 개선 사항

1. **접기/펼치기 기능**: 각 섹션을 토글 가능하게 하여 사용자가 필요한 정보만 표시
2. **북마크 기능**: 자주 확인하는 섹션을 상단에 고정
3. **인쇄 최적화**: 레이아웃을 인쇄 친화적으로 재구성
4. **키보드 네비게이션**: 섹션 간 빠른 이동 단축키 추가

## ✅ 작업 완료 체크리스트

- [x] 레이아웃 순서 분석
- [x] 섹션 이동 구현
- [x] 중복 섹션 제거
- [x] 코드 정리 및 최적화
- [x] 반응형 레이아웃 검증
- [x] 문서화 완료
- [ ] 사용자 테스트 및 피드백 수집
- [ ] 프로덕션 배포

## 🔗 관련 작업

- **이전 작업**: 영업비용 조정 기능 안정화 (`operating-cost-adjustment-fix.md`)
- **연관 파일**: `components/business/BusinessRevenueModal.tsx`
- **관련 API**: `/api/revenue/calculate` (매출 계산)
