# (주)공담 C동 순이익 계산 분석

## 🎯 사용자 질문
매출관리에서 **(주)공담 C동** 사업장의 순이익이 **-45만원**으로 표시되는 이유 분석

---

## 📊 데이터베이스에서 조회한 실제 데이터

### 매출 관련 필드
```
total_revenue: 0원
additional_cost: 1,000,000원
additional_installation_revenue: 0원
negotiation: 0원
```

### 비용 관련 필드
```
total_cost: 0원 (매입금액)
total_base_installation_cost: 0원
additional_construction_cost: 0원
```

### 영업 정보
```
sales_office: "블루온"
```

### 실사 정보
```
estimate_survey_date: null
pre_construction_survey_date: null
completion_survey_date: null
```

### 기기 수량
```
모든 기기 수량: 0대
```

---

## 💰 순이익 계산 과정 (코드 로직 기준)

### STEP 1: 조정 매출 계산
```
조정 매출 = total_revenue + additional_cost + additional_installation_revenue - negotiation
          = 0 + 1,000,000 + 0 - 0
          = 1,000,000원
```

### STEP 2: 영업비용 계산
```
영업점: "블루온"
설정 조회 결과: sales_office_settings 테이블이 존재하지 않음
기본값 사용: 10%

영업비용 = 조정 매출 × 10%
         = 1,000,000 × 0.10
         = 100,000원
```

### STEP 3: 실사비용 계산
```
실사일이 모두 null이므로:
실사비용 = 0원
```

### STEP 4: 총이익 계산
```
총이익 = 조정 매출 - 매입금액
       = 1,000,000 - 0
       = 1,000,000원
```

### STEP 5: 최종 순이익 계산
```
순이익 = 총이익 - 영업비용 - 실사비용 - 기본설치비
       = 1,000,000 - 100,000 - 0 - 0
       = 900,000원 ✅
```

---

## 🔍 분석 결과

### 계산 결과: **+900,000원** (손실 아님)

데이터베이스의 실제 데이터를 기반으로 계산하면 **(주)공담 C동**의 순이익은 **+90만원**입니다.

---

## ⚠️ 사용자가 본 -45만원의 원인 추정

### 가능한 원인들:

1. **UI에서 본 데이터가 최신이 아님**
   - 페이지를 새로고침하지 않아서 이전 데이터가 표시됨
   - 해결: 매출관리 페이지에서 F5로 새로고침

2. **다른 사업장과 혼동**
   - "(주)공담 C동"이 아닌 다른 사업장의 데이터를 확인한 경우
   - 해결: 사업장 이름 재확인

3. **데이터가 최근에 수정됨**
   - 분석 스크립트 실행 시점 이후에 데이터가 변경됨
   - 현재 DB의 `updated_at`: `2025-10-24T05:11:14.069562+00:00`

4. **필터나 정렬이 적용됨**
   - 매출관리 페이지에서 필터나 정렬 기능으로 다른 사업장이 표시됨

5. **`additional_cost` 필드의 오해**
   - 필드명은 "additional_cost"(추가 비용)이지만
   - 코드 로직에서는 **매출에 더하는** 항목으로 사용됨
   - `line 384: const adjustedRevenue = totalRevenue + additionalCost + ...`
   - ⚠️ 이 필드가 의미상으로는 "비용"이지만 계산상으로는 "추가 매출"로 취급됨

---

## 📋 필드명과 실제 사용의 불일치 문제

### `additional_cost` 필드의 문제점

**필드명**: `additional_cost` (추가 비용)
**실제 사용**: 매출에 **더해지는** 항목

```typescript
// app/admin/revenue/page.tsx:384
const adjustedRevenue = totalRevenue + additionalCost + additionalInstallationRevenue - negotiation;
```

이 로직에 따르면:
- `additional_cost`는 **비용이 아니라 추가 매출**로 계산됨
- 1,000,000원이 매출에 더해짐
- 이로 인해 영업비용도 증가 (10% = 100,000원)

### 만약 `additional_cost`를 **실제 비용**으로 처리해야 한다면:

```
순이익 = 총이익 - additional_cost - 영업비용 - 실사비용 - 기본설치비
       = 0 - 1,000,000 - 0 - 0 - 0
       = -1,000,000원
```

하지만 이것도 -45만원이 아닙니다.

---

## 🎯 권장 조치

### 1. 즉시 확인 사항
- 매출관리 페이지에서 **(주)공담 C동** 사업장 재확인
- 브라우저 새로고침 (F5) 후 순이익 값 재확인
- 사업장 검색으로 "공담 C동"이 맞는지 확인

### 2. 만약 여전히 -45만원이 표시된다면
- 브라우저 개발자 도구 (F12) 열기
- Console 탭에서 다음 로그 확인:
  ```
  💰 [(주)공담 C동] 영업비용 계산
  ⚠️ [(주)공담 C동] 영업점 설정 없음
  💰 [(주)공담 C동] 총 실사비용
  ```
- Network 탭에서 `/api/business-info-direct` 응답 데이터 확인

### 3. `additional_cost` 필드의 의미 명확화 필요
현재 코드에서는 `additional_cost`가 **매출에 더해지는** 항목으로 사용되고 있습니다.
만약 이 필드가 **실제로 비용**이어야 한다면 코드 수정이 필요합니다.

---

## 📝 결론

**데이터베이스 기준 계산**: (주)공담 C동의 순이익은 **+900,000원**

사용자가 본 **-450,000원**은 다음 가능성이 높습니다:
1. 다른 사업장 데이터를 확인함
2. 페이지 새로고침 필요
3. 데이터가 최근에 수정됨

정확한 원인 파악을 위해서는 사용자가 실제로 보고 있는 화면의 스크린샷이나
브라우저 개발자 도구의 콘솔 로그를 확인해야 합니다.
