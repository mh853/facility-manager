# 발주서 생성 모달 필드 업데이트

## 완료일
2025-11-04

## 요약
에코센스 발주서 생성 모달에서 "전류계 굵기"를 "전류계 타입"으로 변경하고, 4가지 새로운 필드를 추가했습니다.

---

## 변경 사항

### 1. 필드명 변경
- **변경 전**: 전류계 굵기
- **변경 후**: 전류계 타입

### 2. 추가된 필드 (4개)

#### ① 온도센서 타입
- **옵션**: 프렌지타입 / 니플(소켓)타입
- **타입**: 라디오 버튼 선택
- **기본값**: 없음 (사용자 선택 필요)

#### ② 온도센서 길이
- **옵션**: 10CM / 20CM / 40CM
- **타입**: 라디오 버튼 선택
- **기본값**: 10CM

#### ③ PH 인디케이터 부착위치
- **옵션**:
  - 방지시설판넬(타공)
  - 독립형하이박스부착
  - 해당없음
- **타입**: 라디오 버튼 선택
- **기본값**: 독립형하이박스부착

#### ④ 결제조건*세금계산서 발행 후 7일 이내
- **옵션**:
  - 선금5(발주기준) | 잔금5(납품완료기준)
  - 납품 후 완납(납품완료기준)
  - 기타사항(선입금)
- **타입**: 라디오 버튼 선택
- **기본값**: 없음 (사용자 선택 필요)

---

## 수정된 파일

### 1. 타입 정의
**`types/document-automation.ts`**
```typescript
export interface PurchaseOrderDataEcosense extends PurchaseOrderData {
  // ... 기존 필드들

  // 온도센서 타입
  temperature_sensor_type?: 'flange' | 'nipple' // 프렌지타입/니플(소켓)타입

  // 온도센서 길이
  temperature_sensor_length?: '10cm' | '20cm' | '40cm' // 기본값: 10cm

  // PH 인디케이터 부착위치
  ph_indicator_location?: 'panel' | 'independent_box' | 'none' // 기본값: independent_box

  // 결제조건*세금계산서 발행 후 7일 이내
  payment_terms?: 'prepay_5_balance_5' | 'full_after_delivery' | 'other_prepaid'
}
```

### 2. UI 컴포넌트 - 미리보기
**`components/EcosensePurchaseOrderForm.tsx`**
- "전류계 굵기" → "전류계 타입" 제목 변경
- 4가지 새로운 섹션 추가:
  - 온도센서 타입 (체크박스 표시)
  - 온도센서 길이 (선택된 값 표시)
  - PH 인디케이터 부착위치 (선택된 값 표시)
  - 결제조건 (선택된 값 표시)

### 3. 모달 컴포넌트 - 입력 폼
**`app/admin/document-automation/components/PurchaseOrderModal.tsx`**

#### 기본값 설정 로직 추가
```typescript
// 기본값 설정
if (!loadedData.temperature_sensor_length) {
  loadedData.temperature_sensor_length = '10cm'
}
if (!loadedData.ph_indicator_location) {
  loadedData.ph_indicator_location = 'independent_box'
}
```

#### 4가지 입력 섹션 추가
각 섹션은 라디오 버튼 그룹으로 구성되어 있으며, 사용자가 선택할 수 있습니다.

### 4. Excel 생성기
**`lib/document-generators/excel-generator-ecosense-template.ts`**

#### 전류계 타입 로직 개선
```typescript
// 42행: 배출전류계 (사용자 지정 타입 적용)
if (dischargeCt > 0) {
  // 사용자가 지정한 타입별 수량 사용
  worksheet.getCell('U42').value = data.ct_16l || dischargeCt
  worksheet.getCell('AE42').value = data.ct_24l || 0
  worksheet.getCell('AO42').value = data.ct_36l || 0
}
```

#### 새로운 필드 매핑
- **44행**: 온도센서 타입 (U44: 프렌지타입, AJ44: 니플타입)
- **46행**: 온도센서 길이 (U46: 10CM, AE46: 20CM, AO46: 40CM)
- **48행**: PH 인디케이터 부착위치 (U48: 판넬타공, AE48: 독립형박스, AO48: 해당없음)
- **50행**: 결제조건 (U50: 선금5|잔금5, AE50: 납품완납, AO50: 기타선입금)

각 필드는 체크박스 스타일로 표시됩니다 (☑ / ☐).

---

## UI 배치 순서

발주서 모달에서 필드들은 다음 순서로 표시됩니다:

1. **전류계 타입 설정** (배출 전류계 기준)
   - 16L 수량 (자동 계산)
   - 24L 수량
   - 36L 수량

2. **온도센서 타입** ⭐ NEW
   - 프렌지타입 / 니플(소켓)타입

3. **온도센서 길이** ⭐ NEW
   - 10CM / 20CM / 40CM (기본값: 10CM)

4. **PH 인디케이터 부착위치** ⭐ NEW
   - 방지시설판넬(타공) / 독립형하이박스부착 / 해당없음 (기본값: 독립형하이박스부착)

5. **결제조건*세금계산서 발행 후 7일 이내** ⭐ NEW
   - 선금5|잔금5 / 납품완납 / 기타선입금

6. **택배 주소**
   - 주소 선택 및 관리

7. **발주서 미리보기**
   - 실시간 미리보기 표시

---

## 기본값 정책

| 필드 | 기본값 | 설정 위치 |
|------|--------|-----------|
| 온도센서 타입 | 없음 | - |
| 온도센서 길이 | 10CM | `PurchaseOrderModal.tsx:72` |
| PH 인디케이터 부착위치 | 독립형하이박스부착 | `PurchaseOrderModal.tsx:75` |
| 결제조건 | 없음 | - |

---

## 테스트 시나리오

### 시나리오 1: 기본값 확인
1. 발주서 생성 모달 열기
2. **결과**:
   - 온도센서 길이: 10CM 선택됨 ✅
   - PH 인디케이터: 독립형하이박스부착 선택됨 ✅

### 시나리오 2: 옵션 변경
1. 온도센서 타입: 니플(소켓)타입 선택
2. 온도센서 길이: 40CM 선택
3. PH 인디케이터: 방지시설판넬(타공) 선택
4. 결제조건: 선금5|잔금5 선택
5. 발주서 다운로드
6. **결과**: Excel 파일에 선택한 옵션이 체크(☑)되어 있음 ✅

### 시나리오 3: 미리보기 확인
1. 모달에서 옵션 선택
2. 하단 미리보기 영역 확인
3. **결과**: 선택한 값들이 실시간으로 미리보기에 표시됨 ✅

---

## Excel 템플릿 매핑

Excel 파일의 셀 위치:

```
@_발주서(에코센스_KT무선)_250701.xlsx

[ 41행 ] 송풍+펌프 전류계
         U41: 16L | AE41: 24L | AO41: 36L

[ 42행 ] 배출 전류계
         U42: 16L | AE42: 24L | AO42: 36L

[ 44행 ] 온도센서 타입
         U44: 프렌지타입 | AJ44: 니플(소켓)타입

[ 46행 ] 온도센서 길이
         U46: 10CM | AE46: 20CM | AO46: 40CM

[ 48행 ] PH 인디케이터 부착위치
         U48: 판넬(타공) | AE48: 독립형박스 | AO48: 해당없음

[ 50행 ] 결제조건
         U50: 선금5|잔금5 | AE50: 납품완납 | AO50: 기타선입금
```

---

## 주의사항

1. **타입 안정성**: 모든 새 필드는 optional(`?`)로 정의되어 기존 데이터 호환성 유지
2. **기본값**: 일부 필드는 기본값이 설정되므로 사용자가 선택하지 않아도 동작
3. **Excel 매핑**: 셀 위치는 템플릿 파일의 구조를 따름 (변경 시 주의 필요)
4. **체크박스 표시**: Excel에서 `☑`(체크), `☐`(미체크) 문자로 표현

---

## 향후 개선 사항

1. 결제조건 기본값 추가 고려
2. 온도센서 타입 기본값 추가 고려
3. 필드 간 의존성 검증 로직 추가 (필요시)
4. Excel 템플릿 파일 업데이트 (새 행이 정확한 위치에 있는지 확인)

---

## 완료 ✅

모든 수정사항이 완료되었으며, 타입 체크도 통과했습니다. 발주서 생성 모달에서 4가지 새로운 필드를 입력할 수 있으며, Excel 파일 생성 시 올바르게 반영됩니다.
