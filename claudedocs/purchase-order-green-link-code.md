# ë°œì£¼ì„œ PDF ëŒ€ê¸°í•„ì¦ - ê·¸ë¦°ë§í¬ì½”ë“œ í‘œì‹œ ì¶”ê°€

## ìˆ˜ì • ì¼ì‹œ
2025-11-04

## ìš”êµ¬ì‚¬í•­

**ì‚¬ìš©ì í”¼ë“œë°±**:
- "ë°œì£¼ì„œ ëª¨ë‹¬ì˜ ë¯¸ë¦¬ë³´ê¸°ì™€ ë‹¤ìš´ë¡œë“œí•  ë•Œ ì œì¼ ì•„ë˜ë¶€ë¶„ì— ëŒ€ê¸°í•„ì¦ ì •ë³´ê°€ ìˆì–´"
- "ê±°ê¸°ì— ì‹œì„¤ì— í•´ë‹¹í•˜ëŠ” ê·¸ë¦°ë§í¬ì½”ë“œë„ í‘œí˜„í•´ì¤˜"
- "í•´ë‹¹ ì‹œì„¤ì— í• ë‹¹í•œ ê·¸ë¦°ë§í¬ ì½”ë“œë¥¼ í™•ì¸í•´ì•¼í•´"

**ë ˆì´ì•„ì›ƒ ì°¸ê³ **: `ìŠ¤ìƒ·/ë ˆì´ì•„ì›ƒ2.png`
- ë°°ì¶œêµ¬ë³„ ì‹œì„¤ í…Œì´ë¸”ì— "ê·¸ë¦°ë§í¬ì½”ë“œ" ì»¬ëŸ¼ í‘œì‹œ
- ì˜ˆ: ë°©ì§€ì‹œì„¤ì— "P0501,F0001"ê³¼ ê°™ì€ ì½”ë“œ í‘œì‹œ

## í˜„ì¬ ìƒí™©

### Before (ìˆ˜ì • ì „)

**ëŒ€ê¸°í•„ì¦ ë°°ì¶œì‹œì„¤/ë°©ì§€ì‹œì„¤ í…Œì´ë¸”**:
```
| ì‹œì„¤ë²ˆí˜¸ | ì‹œì„¤ëª… | ìš©ëŸ‰ | ìˆ˜ëŸ‰ |
```

**ë¬¸ì œì **:
- ê·¸ë¦°ë§í¬ì½”ë“œ ì»¬ëŸ¼ ì—†ìŒ
- ì‹œì„¤ë³„ ê·¸ë¦°ë§í¬ì½”ë“œ ì •ë³´ê°€ PDFì— í‘œì‹œë˜ì§€ ì•ŠìŒ
- ì‚¬ìš©ìê°€ ì‹œì„¤ë³„ ì½”ë“œë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŒ

## ì ìš©ëœ ìˆ˜ì •

### 1. íƒ€ì… ì •ì˜ì— green_link_code ì¶”ê°€

**íŒŒì¼**: `types/document-automation.ts` (Lines 169-180)

```typescript
// âŒ Before
discharge_facilities?: Array<{
  name: string
  capacity: string
  quantity: number
}>
prevention_facilities?: Array<{
  name: string
  capacity: string
  quantity: number
}>

// âœ… After
discharge_facilities?: Array<{
  name: string
  capacity: string
  quantity: number
  green_link_code?: string // ê·¸ë¦°ë§í¬ì½”ë“œ ì¶”ê°€
}>
prevention_facilities?: Array<{
  name: string
  capacity: string
  quantity: number
  green_link_code?: string // ê·¸ë¦°ë§í¬ì½”ë“œ ì¶”ê°€
}>
```

### 2. ë°œì£¼ì„œ APIì—ì„œ ê·¸ë¦°ë§í¬ì½”ë“œ í¬í•¨

**íŒŒì¼**: `app/api/document-automation/purchase-order/route.ts` (Lines 285-296)

```typescript
// âŒ Before
discharge_facilities: dischargeFacilities?.map(f => ({
  name: f.facility_name,
  capacity: f.capacity || '',
  quantity: f.quantity || 1
})) || []

prevention_facilities: preventionFacilities?.map(f => ({
  name: f.facility_name,
  capacity: f.capacity || '',
  quantity: f.quantity || 1
})) || []

// âœ… After
discharge_facilities: dischargeFacilities?.map(f => ({
  name: f.facility_name,
  capacity: f.capacity || '',
  quantity: f.quantity || 1,
  green_link_code: f.green_link_code || ''  // ì¶”ê°€
})) || []

prevention_facilities: preventionFacilities?.map(f => ({
  name: f.facility_name,
  capacity: f.capacity || '',
  quantity: f.quantity || 1,
  green_link_code: f.green_link_code || ''  // ì¶”ê°€
})) || []
```

**ë³€ê²½ ì‚¬í•­**:
- ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œ `green_link_code` í•„ë“œë¥¼ ë§¤í•‘ì— í¬í•¨
- ê°’ì´ ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ë¡œ ì²˜ë¦¬

### 3. PDF ìƒì„± - ë°°ì¶œì‹œì„¤ í…Œì´ë¸”ì— ê·¸ë¦°ë§í¬ì½”ë“œ ì»¬ëŸ¼ ì¶”ê°€

**íŒŒì¼**: `lib/document-generators/pdf-generator-ecosense.ts` (Lines 393-422)

```typescript
// âŒ Before
<table>
  <thead>
    <tr>
      <th width="12%">ì‹œì„¤ë²ˆí˜¸</th>
      <th width="48%">ì‹œì„¤ëª…</th>
      <th width="28%">ìš©ëŸ‰</th>
      <th width="12%">ìˆ˜ëŸ‰</th>
    </tr>
  </thead>
  <tbody>
    ${outlet.discharge_facilities.map((facility, idx) => `
    <tr>
      <td>${idx + 1}</td>
      <td>${escapeHtml(facility.name)}</td>
      <td>${escapeHtml(facility.capacity || '-')}</td>
      <td>${facility.quantity || 1}</td>
    </tr>
    `).join('')}
  </tbody>
</table>

// âœ… After
<table>
  <thead>
    <tr>
      <th width="10%">ì‹œì„¤ë²ˆí˜¸</th>
      <th width="38%">ì‹œì„¤ëª…</th>
      <th width="20%">ìš©ëŸ‰</th>
      <th width="10%">ìˆ˜ëŸ‰</th>
      <th width="22%">ê·¸ë¦°ë§í¬ì½”ë“œ</th> <!-- ì¶”ê°€ -->
    </tr>
  </thead>
  <tbody>
    ${outlet.discharge_facilities.map((facility, idx) => `
    <tr>
      <td>${idx + 1}</td>
      <td>${escapeHtml(facility.name)}</td>
      <td>${escapeHtml(facility.capacity || '-')}</td>
      <td>${facility.quantity || 1}</td>
      <td>${escapeHtml(facility.green_link_code || '-')}</td> <!-- ì¶”ê°€ -->
    </tr>
    `).join('')}
  </tbody>
</table>
```

**ë³€ê²½ ì‚¬í•­**:
- í—¤ë”ì— "ê·¸ë¦°ë§í¬ì½”ë“œ" ì»¬ëŸ¼ ì¶”ê°€ (width: 22%)
- ê° ì‹œì„¤ í–‰ì— ê·¸ë¦°ë§í¬ì½”ë“œ í‘œì‹œ
- ê°’ì´ ì—†ìœ¼ë©´ "-" í‘œì‹œ
- ì»¬ëŸ¼ ë„ˆë¹„ ì¬ì¡°ì • (ì‹œì„¤ëª… 48% â†’ 38%, ìš©ëŸ‰ 28% â†’ 20%)

### 4. PDF ìƒì„± - ë°©ì§€ì‹œì„¤ í…Œì´ë¸”ì— ê·¸ë¦°ë§í¬ì½”ë“œ ì»¬ëŸ¼ ì¶”ê°€

**íŒŒì¼**: `lib/document-generators/pdf-generator-ecosense.ts` (Lines 424-453)

```typescript
// âŒ Before
<table>
  <thead>
    <tr>
      <th width="12%">ì‹œì„¤ë²ˆí˜¸</th>
      <th width="48%">ì‹œì„¤ëª…</th>
      <th width="28%">ìš©ëŸ‰</th>
      <th width="12%">ìˆ˜ëŸ‰</th>
    </tr>
  </thead>
  <tbody>
    ${outlet.prevention_facilities.map((facility, idx) => `
    <tr>
      <td>${idx + 1}</td>
      <td>${escapeHtml(facility.name)}</td>
      <td>${escapeHtml(facility.capacity || '-')}</td>
      <td>${facility.quantity || 1}</td>
    </tr>
    `).join('')}
  </tbody>
</table>

// âœ… After
<table>
  <thead>
    <tr>
      <th width="10%">ì‹œì„¤ë²ˆí˜¸</th>
      <th width="38%">ì‹œì„¤ëª…</th>
      <th width="20%">ìš©ëŸ‰</th>
      <th width="10%">ìˆ˜ëŸ‰</th>
      <th width="22%">ê·¸ë¦°ë§í¬ì½”ë“œ</th> <!-- ì¶”ê°€ -->
    </tr>
  </thead>
  <tbody>
    ${outlet.prevention_facilities.map((facility, idx) => `
    <tr>
      <td>${idx + 1}</td>
      <td>${escapeHtml(facility.name)}</td>
      <td>${escapeHtml(facility.capacity || '-')}</td>
      <td>${facility.quantity || 1}</td>
      <td>${escapeHtml(facility.green_link_code || '-')}</td> <!-- ì¶”ê°€ -->
    </tr>
    `).join('')}
  </tbody>
</table>
```

**ë³€ê²½ ì‚¬í•­**: ë°°ì¶œì‹œì„¤ê³¼ ë™ì¼

## ë°ì´í„° íë¦„

### 1. ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‹œì„¤ ì¡°íšŒ

```sql
-- discharge_facilities í…Œì´ë¸”
SELECT
  id,
  facility_name,
  capacity,
  quantity,
  green_link_code  -- âœ… ì¡°íšŒ
FROM discharge_facilities
WHERE outlet_id = ?

-- prevention_facilities í…Œì´ë¸”
SELECT
  id,
  facility_name,
  capacity,
  quantity,
  green_link_code  -- âœ… ì¡°íšŒ
FROM prevention_facilities
WHERE outlet_id = ?
```

### 2. API ë§¤í•‘

```
Database â†’ API Response
------------------------------------------------
facility_name     â†’ name
capacity          â†’ capacity
quantity          â†’ quantity
green_link_code   â†’ green_link_code  âœ… ì¶”ê°€
```

### 3. PDF ìƒì„±

```
API Response â†’ PDF Table
------------------------------------------------
ì‹œì„¤ë²ˆí˜¸:  ìë™ ìƒì„± (idx + 1)
ì‹œì„¤ëª…:    facility.name
ìš©ëŸ‰:      facility.capacity
ìˆ˜ëŸ‰:      facility.quantity
ê·¸ë¦°ë§í¬ì½”ë“œ: facility.green_link_code  âœ… ì¶”ê°€
```

## UI ë³€ê²½ ì‚¬í•­

### PDF í…Œì´ë¸” ë ˆì´ì•„ì›ƒ

**Before**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ì‹œì„¤ë²ˆí˜¸ â”‚ ì‹œì„¤ëª…                   â”‚ ìš©ëŸ‰         â”‚ ìˆ˜ëŸ‰   â”‚
â”‚  12%    â”‚ 48%                      â”‚ 28%          â”‚ 12%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    1    â”‚ ì €ì¥ì‹œì„¤                 â”‚ 63ã¥         â”‚   1    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**After**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ì‹œì„¤ë²ˆí˜¸â”‚ ì‹œì„¤ëª…                â”‚ ìš©ëŸ‰     â”‚ ìˆ˜ëŸ‰   â”‚ ê·¸ë¦°ë§í¬ì½”ë“œ â”‚
â”‚  10%   â”‚ 38%                   â”‚ 20%      â”‚ 10%    â”‚ 22%          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   1    â”‚ ì €ì¥ì‹œì„¤              â”‚ 63ã¥     â”‚   1    â”‚ ë°°1          â”‚
â”‚   2    â”‚ ì—¬ê³¼ë°í¡ì°©ì—ì˜í•œì‹œì„¤  â”‚ 9.2ã¥/ë¶„ â”‚   1    â”‚ P0501,F0001  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë³€ê²½ ì‚¬í•­**:
- ê·¸ë¦°ë§í¬ì½”ë“œ ì»¬ëŸ¼ ì¶”ê°€ (22% ë„ˆë¹„)
- ì‹œì„¤ëª… ì»¬ëŸ¼ ì¶•ì†Œ (48% â†’ 38%)
- ìš©ëŸ‰ ì»¬ëŸ¼ ì¶•ì†Œ (28% â†’ 20%)
- ì‹œì„¤ë²ˆí˜¸/ìˆ˜ëŸ‰ ì»¬ëŸ¼ ìµœì í™” (12% â†’ 10%)

### ìŠ¤íƒ€ì¼ë§

**ë°°ì¶œì‹œì„¤ (ë¹¨ê°„ìƒ‰ ê³„ì—´)**:
- í—¤ë” ë°°ê²½ìƒ‰: `#fee2e2` (ì—°í•œ ë¹¨ê°•)
- ì œëª© ìƒ‰ìƒ: `#dc2626` (ë¹¨ê°•)

**ë°©ì§€ì‹œì„¤ (ë…¹ìƒ‰ ê³„ì—´)**:
- í—¤ë” ë°°ê²½ìƒ‰: `#dcfce7` (ì—°í•œ ë…¹ìƒ‰)
- ì œëª© ìƒ‰ìƒ: `#16a34a` (ë…¹ìƒ‰)

## í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ê·¸ë¦°ë§í¬ì½”ë“œê°€ ìˆëŠ” ì‹œì„¤

**ë°ì´í„°**:
```json
{
  "prevention_facilities": [{
    "name": "ì—¬ê³¼ë°í¡ì°©ì—ì˜í•œì‹œì„¤",
    "capacity": "420ã¥/ë¶„",
    "quantity": 1,
    "green_link_code": "P0501,F0001"
  }]
}
```

**ê¸°ëŒ€ PDF ì¶œë ¥**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1    â”‚ ì—¬ê³¼ë°í¡ì°©ì—ì˜í•œì‹œì„¤  â”‚ 420ã¥/ë¶„ â”‚   1    â”‚ P0501,F0001  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ê·¸ë¦°ë§í¬ì½”ë“œê°€ ì—†ëŠ” ì‹œì„¤

**ë°ì´í„°**:
```json
{
  "discharge_facilities": [{
    "name": "ì €ì¥ì‹œì„¤",
    "capacity": "63ã¥",
    "quantity": 1,
    "green_link_code": ""
  }]
}
```

**ê¸°ëŒ€ PDF ì¶œë ¥**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1    â”‚ ì €ì¥ì‹œì„¤   â”‚ 63ã¥     â”‚   1    â”‚      -       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ì—¬ëŸ¬ ì‹œì„¤ì´ ìˆëŠ” ë°°ì¶œêµ¬

**ë°ì´í„°**:
```json
{
  "outlet_number": 1,
  "outlet_name": "ë°°ì¶œêµ¬ 1",
  "discharge_facilities": [{
    "name": "ì €ì¥ì‹œì„¤",
    "capacity": "63ã¥",
    "quantity": 1,
    "green_link_code": "ë°°1"
  }],
  "prevention_facilities": [{
    "name": "ì—¬ê³¼ë°í¡ì°©ì—ì˜í•œì‹œì„¤",
    "capacity": "420ã¥/ë¶„",
    "quantity": 1,
    "green_link_code": "P0501,F0001"
  }]
}
```

**ê¸°ëŒ€ PDF ì¶œë ¥**:
```
ë°°ì¶œêµ¬ #1 (ë°°ì¶œêµ¬ 1)

ğŸ­ ë°°ì¶œì‹œì„¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1    â”‚ ì €ì¥ì‹œì„¤   â”‚ 63ã¥     â”‚   1    â”‚ ë°°1          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ›¡ï¸ ë°©ì§€ì‹œì„¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1    â”‚ ì—¬ê³¼ë°í¡ì°©ì—ì˜í•œì‹œì„¤  â”‚ 420ã¥/ë¶„ â”‚   1    â”‚ P0501,F0001  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ê´€ë ¨ íŒŒì¼

### ìˆ˜ì •ëœ íŒŒì¼
1. `types/document-automation.ts` (Lines 169-180)
   - ì‹œì„¤ íƒ€ì…ì— `green_link_code?: string` ì¶”ê°€

2. `app/api/document-automation/purchase-order/route.ts` (Lines 285-296)
   - API ë§¤í•‘ì— `green_link_code` í•„ë“œ ì¶”ê°€

3. `lib/document-generators/pdf-generator-ecosense.ts` (Lines 393-453)
   - ë°°ì¶œì‹œì„¤ í…Œì´ë¸”ì— ê·¸ë¦°ë§í¬ì½”ë“œ ì»¬ëŸ¼ ì¶”ê°€
   - ë°©ì§€ì‹œì„¤ í…Œì´ë¸”ì— ê·¸ë¦°ë§í¬ì½”ë“œ ì»¬ëŸ¼ ì¶”ê°€
   - ì»¬ëŸ¼ ë„ˆë¹„ ì¬ì¡°ì •

### ê´€ë ¨ íŒŒì¼ (ë³€ê²½ ì—†ìŒ)
- `lib/database-service.ts` - ì‹œì„¤ í…Œì´ë¸”ì— ì´ë¯¸ `green_link_code` ì»¬ëŸ¼ ì¡´ì¬
- `app/admin/air-permit-detail/page.tsx` - UIì—ì„œ ê·¸ë¦°ë§í¬ì½”ë“œ ì…ë ¥ ê°€ëŠ¥

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì¸

### discharge_facilities í…Œì´ë¸”
```sql
CREATE TABLE discharge_facilities (
  id UUID PRIMARY KEY,
  outlet_id UUID REFERENCES discharge_outlets(id),
  facility_name TEXT,
  capacity TEXT,
  quantity INTEGER,
  green_link_code TEXT,  -- âœ… ì¡´ì¬
  ...
);
```

### prevention_facilities í…Œì´ë¸”
```sql
CREATE TABLE prevention_facilities (
  id UUID PRIMARY KEY,
  outlet_id UUID REFERENCES discharge_outlets(id),
  facility_name TEXT,
  capacity TEXT,
  quantity INTEGER,
  green_link_code TEXT,  -- âœ… ì¡´ì¬
  ...
);
```

## ê°œì„  íš¨ê³¼

### ì •ë³´ ì™„ì „ì„±
- **Before**: ì‹œì„¤ ê¸°ë³¸ ì •ë³´ë§Œ í‘œì‹œ (4ê°œ ì»¬ëŸ¼)
- **After**: ê·¸ë¦°ë§í¬ì½”ë“œ í¬í•¨ ì™„ì „í•œ ì •ë³´ (5ê°œ ì»¬ëŸ¼)
- **ê°œì„ **: ì‹œì„¤ë³„ ì½”ë“œ ì¶”ì  ê°€ëŠ¥

### ì‚¬ìš©ì ê²½í—˜
- ë°œì£¼ì„œ PDFì—ì„œ ì‹œì„¤ë³„ ê·¸ë¦°ë§í¬ì½”ë“œ ì¦‰ì‹œ í™•ì¸ ê°€ëŠ¥
- ë³„ë„ë¡œ ëŒ€ê¸°í•„ì¦ í˜ì´ì§€ í™•ì¸ ë¶ˆí•„ìš”
- ì¸ì‡„ë¬¼ì—ì„œë„ ì½”ë“œ í™•ì¸ ê°€ëŠ¥

### ë°ì´í„° ì¼ê´€ì„±
- ë°ì´í„°ë² ì´ìŠ¤ â†’ API â†’ PDF ì „ì²´ ë°ì´í„° íë¦„ ì¼ê´€ì„± ìœ ì§€
- ëˆ„ë½ëœ í•„ë“œ ì—†ìŒ

## í–¥í›„ ê°œì„  ì•„ì´ë””ì–´

### 1. ê·¸ë¦°ë§í¬ì½”ë“œ í•˜ì´í¼ë§í¬

PDFì—ì„œ ê·¸ë¦°ë§í¬ì½”ë“œë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ì‹œìŠ¤í…œìœ¼ë¡œ ì´ë™:

```typescript
<td>
  <a href="https://greenlink.example.com/facility/${facility.green_link_code}">
    ${escapeHtml(facility.green_link_code || '-')}
  </a>
</td>
```

### 2. QR ì½”ë“œ ìƒì„±

ê·¸ë¦°ë§í¬ì½”ë“œë¥¼ QR ì½”ë“œë¡œ ë³€í™˜í•˜ì—¬ í‘œì‹œ:

```typescript
import QRCode from 'qrcode'

const qrCodeUrl = await QRCode.toDataURL(facility.green_link_code)

<td>
  <img src="${qrCodeUrl}" width="50" height="50" />
  <br />
  ${escapeHtml(facility.green_link_code)}
</td>
```

### 3. ê·¸ë¦°ë§í¬ì½”ë“œ ìœ íš¨ì„± ê²€ì¦

APIì—ì„œ ê·¸ë¦°ë§í¬ì½”ë“œ í˜•ì‹ ê²€ì¦:

```typescript
const greenLinkCodePattern = /^[A-Z]\d{4}(,[A-Z]\d{4})*$/

if (facility.green_link_code && !greenLinkCodePattern.test(facility.green_link_code)) {
  console.warn(`Invalid green link code format: ${facility.green_link_code}`)
}
```

### 4. ê·¸ë¦°ë§í¬ì½”ë“œë³„ ìƒ‰ìƒ êµ¬ë¶„

ì½”ë“œ íƒ€ì…ë³„ë¡œ ìƒ‰ìƒ í‘œì‹œ:

```typescript
const getGreenLinkCodeColor = (code: string) => {
  if (code.startsWith('P')) return '#16a34a' // ë°©ì§€ì‹œì„¤ - ë…¹ìƒ‰
  if (code.startsWith('D')) return '#dc2626' // ë°°ì¶œì‹œì„¤ - ë¹¨ê°•
  if (code.startsWith('F')) return '#2563eb' // í•„í„° - íŒŒë‘
  return '#6b7280' // ê¸°íƒ€ - íšŒìƒ‰
}

<td style="color: ${getGreenLinkCodeColor(facility.green_link_code)};">
  ${escapeHtml(facility.green_link_code || '-')}
</td>
```

## ê²€ì¦ ì™„ë£Œ

- [x] íƒ€ì… ì •ì˜ì— `green_link_code` ì¶”ê°€
- [x] API ë§¤í•‘ì— `green_link_code` í¬í•¨
- [x] ë°°ì¶œì‹œì„¤ í…Œì´ë¸”ì— ê·¸ë¦°ë§í¬ì½”ë“œ ì»¬ëŸ¼ ì¶”ê°€
- [x] ë°©ì§€ì‹œì„¤ í…Œì´ë¸”ì— ê·¸ë¦°ë§í¬ì½”ë“œ ì»¬ëŸ¼ ì¶”ê°€
- [x] ì»¬ëŸ¼ ë„ˆë¹„ ì¬ì¡°ì •
- [x] ê°œë°œ ì„œë²„ ì‹¤í–‰ í™•ì¸ (http://localhost:3002)

## í…ŒìŠ¤íŠ¸ ë°©ë²•

```
1. http://localhost:3002/admin/document-automation ì ‘ì†
2. ë°œì£¼ì„œ ìƒì„± ë˜ëŠ” ê¸°ì¡´ ë°œì£¼ì„œ ì„ íƒ
3. "ë¯¸ë¦¬ë³´ê¸°" ë²„íŠ¼ í´ë¦­
4. PDF í•˜ë‹¨ì˜ ëŒ€ê¸°í•„ì¦ ì •ë³´ í™•ì¸
5. ë°°ì¶œì‹œì„¤/ë°©ì§€ì‹œì„¤ í…Œì´ë¸”ì— "ê·¸ë¦°ë§í¬ì½”ë“œ" ì»¬ëŸ¼ ìˆëŠ”ì§€ í™•ì¸
6. ì‹œì„¤ë³„ ì½”ë“œê°€ ì •í™•í•˜ê²Œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
7. "ë‹¤ìš´ë¡œë“œ" ë²„íŠ¼ í´ë¦­í•˜ì—¬ PDF íŒŒì¼ ì €ì¥
8. ì €ì¥ëœ PDFì—ì„œë„ ê·¸ë¦°ë§í¬ì½”ë“œ í‘œì‹œ í™•ì¸
```

## ë³€ê²½ ì´ë ¥

- 2025-11-04: ë°œì£¼ì„œ PDF ëŒ€ê¸°í•„ì¦ì— ê·¸ë¦°ë§í¬ì½”ë“œ í‘œì‹œ ì¶”ê°€ ì™„ë£Œ
