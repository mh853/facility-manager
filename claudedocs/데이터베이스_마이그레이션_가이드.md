# ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

## ğŸ” ë¬¸ì œ ì§„ë‹¨

### Supabase ìŠ¤í‚¤ë§ˆ ìºì‹œ ì˜¤ë¥˜ (PGRST204)

```
Could not find the 'special_notes' column of 'business_info' in the schema cache
```

**ì›ì¸**: ì‹¤ì œ Supabase ë°ì´í„°ë² ì´ìŠ¤ì— í•„ìˆ˜ ì»¬ëŸ¼ë“¤ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

- âŒ `installation_phase` - ì„¤ì¹˜ ë‹¨ê³„
- âŒ `surveyor_name` - ì‹¤ì‚¬ì ì´ë¦„
- âŒ `surveyor_contact` - ì‹¤ì‚¬ì ì—°ë½ì²˜
- âŒ `surveyor_company` - ì‹¤ì‚¬ì íšŒì‚¬
- âŒ `survey_date` - ì‹¤ì‚¬ ì¼ì
- âŒ `installation_date` - ì„¤ì¹˜ ì¼ì
- âŒ `completion_date` - ì™„ë£Œ ì¼ì
- âŒ `special_notes` - íŠ¹ì´ì‚¬í•­

---

## ğŸ› ï¸ í•´ê²° ë°©ë²•

### 1. Supabase ëŒ€ì‹œë³´ë“œ ì ‘ì†

1. ë¸Œë¼ìš°ì €ì—ì„œ Supabase ëŒ€ì‹œë³´ë“œ ì—´ê¸°: https://supabase.com/dashboard
2. í”„ë¡œì íŠ¸ ì„ íƒ
3. ì™¼ìª½ ë©”ë‰´ì—ì„œ **SQL Editor** í´ë¦­

### 2. SQL ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰

#### ë°©ë²• A: íŒŒì¼ ì—…ë¡œë“œ (ê¶Œì¥)

1. SQL Editorì—ì„œ **New query** í´ë¦­
2. ì•„ë˜ íŒŒì¼ì˜ ë‚´ìš©ì„ ë³µì‚¬:
   ```
   sql/add_facility_management_columns.sql
   ```
3. SQL Editorì— ë¶™ì—¬ë„£ê¸°
4. **RUN** ë²„íŠ¼ í´ë¦­ (ë˜ëŠ” Ctrl+Enter)

#### ë°©ë²• B: ì§ì ‘ ì‹¤í–‰

SQL Editorì— ë‹¤ìŒ SQLì„ ë¶™ì—¬ë„£ê³  ì‹¤í–‰:

```sql
-- ì‹œì„¤ ê´€ë¦¬ ì •ë³´ ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE public.business_info
ADD COLUMN IF NOT EXISTS installation_phase VARCHAR(50) DEFAULT 'presurvey'
    CHECK (installation_phase IN ('presurvey', 'installation', 'completed'));

ALTER TABLE public.business_info
ADD COLUMN IF NOT EXISTS surveyor_name VARCHAR(100);

ALTER TABLE public.business_info
ADD COLUMN IF NOT EXISTS surveyor_contact VARCHAR(50);

ALTER TABLE public.business_info
ADD COLUMN IF NOT EXISTS surveyor_company VARCHAR(100);

ALTER TABLE public.business_info
ADD COLUMN IF NOT EXISTS survey_date DATE;

ALTER TABLE public.business_info
ADD COLUMN IF NOT EXISTS installation_date DATE;

ALTER TABLE public.business_info
ADD COLUMN IF NOT EXISTS completion_date DATE;

ALTER TABLE public.business_info
ADD COLUMN IF NOT EXISTS special_notes TEXT;

-- ì¸ë±ìŠ¤ ìƒì„± (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_business_info_installation_phase
ON public.business_info(installation_phase);

CREATE INDEX IF NOT EXISTS idx_business_info_surveyor
ON public.business_info(surveyor_name);

CREATE INDEX IF NOT EXISTS idx_business_info_dates
ON public.business_info(survey_date, installation_date, completion_date);

-- ì»¬ëŸ¼ ì„¤ëª… ì¶”ê°€
COMMENT ON COLUMN public.business_info.installation_phase IS 'ì„¤ì¹˜ ë‹¨ê³„: presurvey(ì„¤ì¹˜ ì „ ì‹¤ì‚¬), installation(ì¥ë¹„ ì„¤ì¹˜), completed(ì„¤ì¹˜ í›„ ê²€ìˆ˜)';
COMMENT ON COLUMN public.business_info.surveyor_name IS 'ì‹¤ì‚¬ì ì´ë¦„';
COMMENT ON COLUMN public.business_info.surveyor_contact IS 'ì‹¤ì‚¬ì ì—°ë½ì²˜';
COMMENT ON COLUMN public.business_info.surveyor_company IS 'ì‹¤ì‚¬ì ì†Œì† íšŒì‚¬';
COMMENT ON COLUMN public.business_info.survey_date IS 'ì‹¤ì‚¬ ì¼ì';
COMMENT ON COLUMN public.business_info.installation_date IS 'ì„¤ì¹˜ ì¼ì';
COMMENT ON COLUMN public.business_info.completion_date IS 'ì™„ë£Œ ì¼ì';
COMMENT ON COLUMN public.business_info.special_notes IS 'íŠ¹ì´ì‚¬í•­';
```

### 3. ì‹¤í–‰ ê²°ê³¼ í™•ì¸

#### ì„±ê³µ ë©”ì‹œì§€ í™•ì¸:
```
Success. No rows returned
```

#### ì»¬ëŸ¼ ìƒì„± í™•ì¸ ì¿¼ë¦¬ ì‹¤í–‰:
```sql
SELECT column_name, data_type, character_maximum_length, column_default
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'business_info'
  AND column_name IN (
    'installation_phase',
    'surveyor_name',
    'surveyor_contact',
    'surveyor_company',
    'survey_date',
    'installation_date',
    'completion_date',
    'special_notes'
  )
ORDER BY column_name;
```

#### ì˜ˆìƒ ê²°ê³¼:
```
column_name          | data_type          | character_maximum_length | column_default
---------------------|--------------------|--------------------------|-----------------
completion_date      | date               | NULL                     | NULL
installation_date    | date               | NULL                     | NULL
installation_phase   | character varying  | 50                       | 'presurvey'
special_notes        | text               | NULL                     | NULL
survey_date          | date               | NULL                     | NULL
surveyor_company     | character varying  | 100                      | NULL
surveyor_contact     | character varying  | 50                       | NULL
surveyor_name        | character varying  | 100                      | NULL
```

---

## âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ ì‘ì—…

### 1. Supabase ìŠ¤í‚¤ë§ˆ ìºì‹œ ìƒˆë¡œê³ ì¹¨

SupabaseëŠ” ìë™ìœ¼ë¡œ ìŠ¤í‚¤ë§ˆ ìºì‹œë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì§€ë§Œ, ì¦‰ì‹œ ë°˜ì˜ì„ ìœ„í•´:

1. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ **Settings** â†’ **API** ì´ë™
2. **Reset API server** ë²„íŠ¼ í´ë¦­ (ì„ íƒì‚¬í•­)
3. ë˜ëŠ” 2-3ë¶„ ëŒ€ê¸° (ìë™ ìºì‹œ ê°±ì‹ )

### 2. ì• í”Œë¦¬ì¼€ì´ì…˜ í…ŒìŠ¤íŠ¸

```bash
# ê°œë°œ ì„œë²„ ì¬ì‹œì‘ (ì´ë¯¸ ì‹¤í–‰ ì¤‘ì´ë©´ í•„ìš” ì—†ìŒ)
npm run dev
```

1. ì‚¬ì—…ì¥ í˜ì´ì§€ ì ‘ì†: `http://localhost:3000/business/[ì‚¬ì—…ì¥ëª…]`
2. **íŠ¹ì´ì‚¬í•­** ì„¹ì…˜ í…ŒìŠ¤íŠ¸:
   - [í¸ì§‘] í´ë¦­
   - ë‚´ìš© ì…ë ¥ (ì˜ˆ: "í…ŒìŠ¤íŠ¸ íŠ¹ì´ì‚¬í•­")
   - [ì €ì¥] í´ë¦­
   - ë¸Œë¼ìš°ì € ì½˜ì†” í™•ì¸: `{success: true, ...}`
   - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ â†’ ë‚´ìš© ìœ ì§€ í™•ì¸

3. **ì‹¤ì‚¬ì ì •ë³´** ì„¹ì…˜ í…ŒìŠ¤íŠ¸:
   - [í¸ì§‘] í´ë¦­
   - ì •ë³´ ì…ë ¥ (ì´ë¦„, ì—°ë½ì²˜, ë‚ ì§œ)
   - [ì €ì¥] í´ë¦­
   - ì„±ê³µ ë©”ì‹œì§€ í™•ì¸
   - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ â†’ ì •ë³´ ìœ ì§€ í™•ì¸

---

## ğŸ” ë¬¸ì œ í•´ê²°

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨ ì‹œ

#### ì˜¤ë¥˜: "permission denied"
```sql
-- RLS ì •ì±… í™•ì¸
SELECT * FROM pg_policies WHERE tablename = 'business_info';

-- í•„ìš” ì‹œ RLS ì„ì‹œ ë¹„í™œì„±í™” (ê´€ë¦¬ì ê¶Œí•œ í•„ìš”)
ALTER TABLE public.business_info DISABLE ROW LEVEL SECURITY;
-- ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ í›„
ALTER TABLE public.business_info ENABLE ROW LEVEL SECURITY;
```

#### ì˜¤ë¥˜: "column already exists"
```sql
-- ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì»¬ëŸ¼ í™•ì¸
SELECT column_name
FROM information_schema.columns
WHERE table_name = 'business_info'
  AND table_schema = 'public';
```

### ì €ì¥ì´ ì—¬ì „íˆ ì•ˆë  ë•Œ

1. **ë¸Œë¼ìš°ì € ì½˜ì†” í™•ì¸**:
   - ì—¬ì „íˆ `PGRST204` ì—ëŸ¬ â†’ 2-3ë¶„ ëŒ€ê¸° (ìºì‹œ ê°±ì‹ )
   - ë‹¤ë¥¸ ì—ëŸ¬ â†’ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸

2. **ì„œë²„ ë¡œê·¸ í™•ì¸**:
   ```
   ğŸ“ [FACILITY-MGMT] ì—…ë°ì´íŠ¸ ê²°ê³¼: {updatedBusiness: {...}, updateError: null}
   ```
   - `updateError: null` â†’ ì„±ê³µ
   - `updateError: {...}` â†’ ì—ëŸ¬ ë‚´ìš© í™•ì¸

3. **Supabase ì§ì ‘ í™•ì¸**:
   ```sql
   SELECT id, business_name, special_notes, surveyor_name
   FROM public.business_info
   WHERE id = '727c5a4d-5d46-46a7-95ec-eab2d80992c6';
   ```

---

## ğŸ“Š ì˜ˆìƒ ê²°ê³¼

- âœ… ë°ì´í„°ë² ì´ìŠ¤ì— 8ê°œ ì»¬ëŸ¼ ì¶”ê°€
- âœ… 3ê°œ ì¸ë±ìŠ¤ ìƒì„± (ì„±ëŠ¥ ìµœì í™”)
- âœ… íŠ¹ì´ì‚¬í•­ ì €ì¥ ì„±ê³µ
- âœ… ì‹¤ì‚¬ì ì •ë³´ ì €ì¥ ì„±ê³µ
- âœ… í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ë°ì´í„° ìœ ì§€

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í›„:

1. âœ… íŠ¹ì´ì‚¬í•­ ì €ì¥/ë¡œë“œ í…ŒìŠ¤íŠ¸
2. âœ… ì‹¤ì‚¬ì ì •ë³´ ì €ì¥/ë¡œë“œ í…ŒìŠ¤íŠ¸
3. âœ… ì—¬ëŸ¬ ì‚¬ì—…ì¥ì—ì„œ ë™ì‘ í™•ì¸
4. âœ… í”„ë¡œë•ì…˜ í™˜ê²½ ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš
