# ë‹¨ê³„ ì´ë ¥ í™•ì¸ ë°©ë²• ê°€ì´ë“œ

## ğŸ“ ì–´ë””ì„œ í™•ì¸í•˜ë‚˜ìš”?

### 1. **ì—…ë¬´ ê´€ë¦¬ í˜ì´ì§€** (`/admin/tasks`)

#### ë°©ë²• 1: ì—…ë¬´ ì¹´ë“œ í´ë¦­
1. ì—…ë¬´ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™
2. ì¹¸ë°˜ ë³´ë“œì—ì„œ ì—…ë¬´ ì¹´ë“œ í´ë¦­
3. ì—…ë¬´ ìƒì„¸ ëª¨ë‹¬ì´ ì—´ë¦¼
4. í•˜ë‹¨ì˜ **"ë‹¨ê³„ ì´ë ¥"** ì„¹ì…˜ í´ë¦­
5. "í¼ì¹˜ê¸°" ë²„íŠ¼ í´ë¦­í•˜ë©´ íƒ€ì„ë¼ì¸ í‘œì‹œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì—…ë¬´ ìƒì„¸ ëª¨ë‹¬                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Œ ê¸°ë³¸ ì •ë³´                     â”‚
â”‚ ğŸ¢ ì‚¬ì—…ì¥ ì •ë³´                   â”‚
â”‚ ğŸ“ ì„¤ëª…                          â”‚
â”‚ ğŸ“‹ ë©”ëª¨                          â”‚
â”‚                                 â”‚
â”‚ ğŸ“… ë‹¨ê³„ ì´ë ¥  [í¼ì¹˜ê¸°]  â† í´ë¦­! â”‚
â”‚   â†“ í¼ì¹˜ë©´                       â”‚
â”‚   âœ… ê³ ê°ì ‘ì´‰ (4ì¼ ì†Œìš”)         â”‚
â”‚   âœ… í˜„ì¥ì‹¤ì‚¬ (5ì¼ ì†Œìš”)         â”‚
â”‚   ğŸ”µ ê²¬ì  (ì§„í–‰ ì¤‘)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### í‘œì‹œë˜ëŠ” ì •ë³´:
- âœ… **ë‹¨ê³„ëª…**: ê³ ê°ì ‘ì´‰, í˜„ì¥ì‹¤ì‚¬, ê²¬ì  ë“±
- ğŸ“… **ì‹œì‘ì¼**: 2024ë…„ 1ì›” 1ì¼ 09:00
- âœ… **ì™„ë£Œì¼**: 2024ë…„ 1ì›” 5ì¼ 17:00 (ì™„ë£Œëœ ë‹¨ê³„ë§Œ)
- â±ï¸ **ì†Œìš” ì‹œê°„**: 4ì¼ (ìë™ ê³„ì‚°)
- ğŸ‘¤ **ë‹´ë‹¹ì**: ì´ì¤€í˜¸
- ğŸ“ **ë©”ëª¨**: ë‹¨ê³„ë³„ ì¶”ê°€ ì •ë³´
- ğŸ“Š **í†µê³„**: ì™„ë£Œëœ ë‹¨ê³„ ìˆ˜, ì´ ì†Œìš” ì‹œê°„

---

### 2. **APIë¡œ ì§ì ‘ ì¡°íšŒ**

ê°œë°œìë‚˜ ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ë™ ì‹œ:

```bash
# íŠ¹ì • ì—…ë¬´ì˜ ì´ë ¥ ì¡°íšŒ
GET /api/facility-tasks/{ì—…ë¬´ID}/history

# íƒ€ì„ë¼ì¸ í˜•ì‹ìœ¼ë¡œ ì¡°íšŒ
GET /api/facility-tasks/{ì—…ë¬´ID}/history?timeline=true
```

**ì‘ë‹µ ì˜ˆì‹œ:**
```json
{
  "success": true,
  "data": [
    {
      "id": "abc-123",
      "status": "customer_contact",
      "started_at": "2024-01-01T09:00:00Z",
      "completed_at": "2024-01-05T17:00:00Z",
      "duration_days": 4,
      "assignee_name": "ì´ì¤€í˜¸"
    },
    {
      "status": "site_inspection",
      "started_at": "2024-01-05T17:00:00Z",
      "completed_at": "2024-01-10T15:00:00Z",
      "duration_days": 5,
      "assignee_name": "ê¹€ì˜í¬"
    },
    {
      "status": "quotation",
      "started_at": "2024-01-10T15:00:00Z",
      "completed_at": null,
      "duration_days": null,
      "assignee_name": "ì´ì¤€í˜¸"
    }
  ]
}
```

---

### 3. **Supabase ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì ‘ ì¡°íšŒ**

ê´€ë¦¬ìê°€ SQLë¡œ ì§ì ‘ í™•ì¸:

```sql
-- íŠ¹ì • ì—…ë¬´ì˜ ë‹¨ê³„ ì´ë ¥ ì¡°íšŒ
SELECT
  status,
  started_at,
  completed_at,
  duration_days,
  assignee_name,
  notes
FROM task_status_history
WHERE task_id = 'ì—…ë¬´ID'
ORDER BY started_at ASC;

-- íƒ€ì„ë¼ì¸ ë·° ì‚¬ìš© (ë‹¤ìŒ ë‹¨ê³„ ì •ë³´ í¬í•¨)
SELECT * FROM task_status_timeline
WHERE task_id = 'ì—…ë¬´ID';

-- ì‚¬ì—…ì¥ë³„ ëª¨ë“  ì´ë ¥ ì¡°íšŒ
SELECT
  tsh.*,
  ft.title as task_title
FROM task_status_history tsh
JOIN facility_tasks ft ON tsh.task_id = ft.id
WHERE tsh.business_name = 'ë†ì—…íšŒì‚¬ë²•ì¸ ì£¼ì‹íšŒì‚¬ ê±´ì–‘'
ORDER BY tsh.started_at DESC;
```

---

## ğŸ¯ UI ë™ì‘ íë¦„

### ì—…ë¬´ ìƒì„± ì‹œ
```
1. ìƒˆ ì—…ë¬´ ìƒì„±
   â””â”€> "ê³ ê°ì ‘ì´‰" ë‹¨ê³„ë¡œ ì‹œì‘
   â””â”€> task_status_historyì— ìë™ ê¸°ë¡
       âœ… started_at: í˜„ì¬ ì‹œê°
       â³ completed_at: null (ì§„í–‰ ì¤‘)
```

### ë‹¨ê³„ ë³€ê²½ ì‹œ
```
2. "ê³ ê°ì ‘ì´‰" â†’ "í˜„ì¥ì‹¤ì‚¬"ë¡œ ë³€ê²½
   â””â”€> ì´ì „ ë‹¨ê³„ ìë™ ì™„ë£Œ ì²˜ë¦¬
       âœ… completed_at: í˜„ì¬ ì‹œê°
       ğŸ“Š duration_days: 4 (ìë™ ê³„ì‚°)
   â””â”€> ìƒˆ ë‹¨ê³„ ì‹œì‘ ê¸°ë¡
       âœ… started_at: í˜„ì¬ ì‹œê°
       â³ completed_at: null
```

### ì´ë ¥ ì¡°íšŒ ì‹œ
```
3. ì—…ë¬´ ì¹´ë“œ í´ë¦­ â†’ ëª¨ë‹¬ ì—´ë¦¼
   â””â”€> "ë‹¨ê³„ ì´ë ¥" ì„¹ì…˜ í´ë¦­
   â””â”€> API í˜¸ì¶œ: GET /api/facility-tasks/{id}/history
   â””â”€> íƒ€ì„ë¼ì¸ í˜•ì‹ìœ¼ë¡œ í‘œì‹œ
       âœ… ê³ ê°ì ‘ì´‰ (ì™„ë£Œ, 4ì¼ ì†Œìš”)
       âœ… í˜„ì¥ì‹¤ì‚¬ (ì™„ë£Œ, 5ì¼ ì†Œìš”)
       ğŸ”µ ê²¬ì  (ì§„í–‰ ì¤‘)
```

---

## ğŸ“Š íƒ€ì„ë¼ì¸ UI ì˜ˆì‹œ

```
ğŸ“… ë‹¨ê³„ ì´ë ¥
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  âœ… â”€â”¬â”€ ê³ ê°ì ‘ì´‰
      â”‚  ë‹´ë‹¹ì: ì´ì¤€í˜¸
      â”‚  ì‹œì‘: 2024ë…„ 1ì›” 1ì¼ 09:00
      â”‚  ì™„ë£Œ: 2024ë…„ 1ì›” 5ì¼ 17:00
      â”‚  ì†Œìš”: 4ì¼
      â”‚  ë©”ëª¨: ì—…ë¬´ ìƒì„± - ëŒ€ê¸°ë°°ì¶œì‹œì„¤ ì„¤ì¹˜ ê²€í† 
      â”‚
  âœ… â”€â”¬â”€ í˜„ì¥ì‹¤ì‚¬
      â”‚  ë‹´ë‹¹ì: ê¹€ì˜í¬
      â”‚  ì‹œì‘: 2024ë…„ 1ì›” 5ì¼ 17:00
      â”‚  ì™„ë£Œ: 2024ë…„ 1ì›” 10ì¼ 15:00
      â”‚  ì†Œìš”: 5ì¼
      â”‚  ë©”ëª¨: ë‹¨ê³„ ë³€ê²½: ê³ ê°ì ‘ì´‰ â†’ í˜„ì¥ì‹¤ì‚¬
      â”‚
  ğŸ”µ â”€â”¬â”€ ê²¬ì  (ì§„í–‰ ì¤‘)
      â”‚  ë‹´ë‹¹ì: ì´ì¤€í˜¸
      â”‚  ì‹œì‘: 2024ë…„ 1ì›” 10ì¼ 15:00
      â”‚  ë©”ëª¨: ë‹¨ê³„ ë³€ê²½: í˜„ì¥ì‹¤ì‚¬ â†’ ê²¬ì 

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì™„ë£Œëœ ë‹¨ê³„: 2ê°œ
ì´ ì†Œìš” ì‹œê°„: 9ì¼
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### ê¸°ì¡´ ì—…ë¬´
- **ì´ë¯¸ ì§„í–‰ ì¤‘ì¸ ì—…ë¬´**ëŠ” ê³¼ê±° ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤
- ì•ìœ¼ë¡œ ìƒíƒœë¥¼ ë³€ê²½í•  ë•Œë¶€í„° ì´ë ¥ì´ ìŒ“ì…ë‹ˆë‹¤
- í•„ìš”ì‹œ ê´€ë¦¬ìê°€ SQLë¡œ ìˆ˜ë™ ì¶”ê°€ ê°€ëŠ¥

### ì´ë ¥ ë°ì´í„°
- ì—…ë¬´ ì‚­ì œ ì‹œ ì´ë ¥ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤
- ì´ë ¥ì€ ìˆ˜ì •í•  ìˆ˜ ì—†ê³  ì¡°íšŒë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤
- ì†Œìš” ì‹œê°„ì€ ìë™ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤

---

## ğŸš€ ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 1. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
- [ ] Supabase SQL Editorì—ì„œ `sql/task_status_history.sql` ì‹¤í–‰
- [ ] `task_status_history` í…Œì´ë¸” ìƒì„± í™•ì¸
- [ ] ë·° ìƒì„± í™•ì¸ (`task_status_timeline`, `task_status_statistics`)

### 2. ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ìƒˆ ì—…ë¬´ ìƒì„± â†’ ì´ë ¥ ìë™ ê¸°ë¡ í™•ì¸
- [ ] ìƒíƒœ ë³€ê²½ â†’ ì´ë ¥ ì—…ë°ì´íŠ¸ í™•ì¸
- [ ] ì—…ë¬´ ëª¨ë‹¬ì—ì„œ "ë‹¨ê³„ ì´ë ¥" ì„¹ì…˜ í‘œì‹œ í™•ì¸
- [ ] íƒ€ì„ë¼ì¸ UI ì •ìƒ ì‘ë™ í™•ì¸

### 3. ì‚¬ìš©ì ì•ˆë‚´
- [ ] ì‚¬ìš©ìì—ê²Œ ìƒˆ ê¸°ëŠ¥ ì•ˆë‚´
- [ ] "ë‹¨ê³„ ì´ë ¥" ì„¹ì…˜ ìœ„ì¹˜ ì„¤ëª…
- [ ] ê¸°ì¡´ ì—…ë¬´ëŠ” ì´ë ¥ì´ ì—†ë‹¤ëŠ” ì  ì•ˆë‚´

---

## ğŸ’¡ í™œìš© íŒ

### 1. í†µê³„ ë¶„ì„
```sql
-- ë‹¨ê³„ë³„ í‰ê·  ì†Œìš” ì‹œê°„ ì¡°íšŒ
SELECT * FROM task_status_statistics
WHERE status = 'site_inspection';

-- ê°€ì¥ ì˜¤ë˜ ê±¸ë¦° ë‹¨ê³„ í™•ì¸
SELECT
  business_name,
  status,
  duration_days
FROM task_status_history
WHERE completed_at IS NOT NULL
ORDER BY duration_days DESC
LIMIT 10;
```

### 2. ë³‘ëª© êµ¬ê°„ ì‹ë³„
```sql
-- í‰ê·  ì´ìƒìœ¼ë¡œ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ë‹¨ê³„
WITH avg_durations AS (
  SELECT status, AVG(duration_days) as avg_days
  FROM task_status_history
  WHERE completed_at IS NOT NULL
  GROUP BY status
)
SELECT
  tsh.business_name,
  tsh.status,
  tsh.duration_days,
  ad.avg_days,
  (tsh.duration_days - ad.avg_days) as delay_days
FROM task_status_history tsh
JOIN avg_durations ad ON tsh.status = ad.status
WHERE tsh.duration_days > ad.avg_days
ORDER BY delay_days DESC;
```

### 3. ë‹´ë‹¹ìë³„ ì²˜ë¦¬ ì†ë„
```sql
-- ë‹´ë‹¹ìë³„ í‰ê·  ì²˜ë¦¬ ì‹œê°„
SELECT
  assignee_name,
  status,
  COUNT(*) as task_count,
  AVG(duration_days) as avg_duration
FROM task_status_history
WHERE completed_at IS NOT NULL
  AND assignee_name IS NOT NULL
GROUP BY assignee_name, status
ORDER BY assignee_name, status;
```

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ
- êµ¬í˜„ ìƒì„¸: `claudedocs/task-status-history-implementation.md`
- API ë¬¸ì„œ: `app/api/facility-tasks/[id]/history/route.ts`
- UI ì»´í¬ë„ŒíŠ¸: `components/TaskHistoryTimeline.tsx`
